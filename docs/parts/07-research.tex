\chapter{Исследовательская часть}

В данном разделе будет описана зависимость времени обработки запроса на получение разметки от числа запросов в секунду, а также сравнение времени обработки запроса с использованием кеширования и без использования кеширования. Также будет описаны технические характеристики устройства, на котором проводились замеры и приведен анализ полученных результатов.

\section{Технические характеристики}

Технические характеристики устройства, на котором выполнялись замеры времени, представлены далее.

\begin{enumerate}
	\item Процессор	Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz, 2592 МГц, ядер: 6, логических процессоров: 12.
	\item Оперативная память: 16 ГБайт.
	\item Операционная система: Майкрософт Windows 10 Pro \cite{windows}.
	\item Использованная подсистема: WSL2 \cite{WSL2}.
\end{enumerate}

При замерах времени ноутбук был включен в сеть электропитания.


\section{Описание использованного для замеров Программного обеспечения}
Для замеров была использована программа JMeter, позволяющая замерить время обработки каждого запросов и генерировать запросы~\cite{JMeter}.


\section{Зависимость скорости обработки запроса от числа запросов в секунду}
Для данного исследования в базу данных было сгенерированно и добавлено 20000 размеченных изображений от одного пользователя и от одного документа.

С использованием JMeter случайно генерировался id разметки для получения, после чего для получения данной разметки генерировались запросы, число клиентов для генерации запросов было равно 40, на каждый клиент выделялся отдельный поток, число запросов от одного клиента равно 1000, запросы одного клиента поступали через каждые 0.1 секунды, также у каждого запроса была случайная задержка от 1 до 990 мс, все было обработано 95000 запросов. После обработки запроса время получения последнего байта ответа записывалось в файле, после чего группировались все запросы в пределах одной секунды и высчитывалось среднее время обработки запроса и число обработанных запросов в секунду. 

Данным образом был отправлен запрос на получение сущности фрагмента, заметим что в данной реализации изображение хранится в виде байт в столбце базы данных.

Результаты измерений представлены в таблице~\ref{t:req_by_sec}.


\begin{table}[h!tbp]
	\centering
	\caption{Зависимость времени обработки запроса от числа запросов в секунду}
	\begin{tabularx}{\linewidth}{|Z|Z|}
		\hline
		 Время обработки (мс) & Число запросов в секунду    \\
		\hline
	2.5   & 2     \\ \hline
	4.33  & 9     \\ \hline
	3.3   & 23    \\ \hline
	2.46  & 39    \\ \hline
	106.89 & 51   \\ \hline
	2.2   & 60    \\ \hline
	251.07 & 70   \\ \hline
	3.09  & 79    \\ \hline
	138.66 & 88   \\ \hline
	130.7 & 94    \\ \hline
	3.04  & 100   \\ \hline
	293.68 & 106  \\ \hline
	277.07 & 112  \\ \hline
	2.79  & 119    \\ \hline
	275.44 & 126  \\ \hline
	2.65  & 133   \\ \hline
	2.37  & 139   \\ \hline
	2.29  & 150   \\ \hline
	2.47  & 158   \\ \hline
	2.47 & 174     \\ \hline
	2.65 & 179     \\ \hline
	2.43 & 184     \\ \hline
	2.86 & 189     \\ \hline
	2.71 & 194     \\ \hline
	2.91 & 199     \\ \hline
	2.8  & 204     \\ \hline
	2.38 & 209     \\ \hline
	2.42 & 214     \\ \hline
	2.27 & 219     \\ \hline
	\end{tabularx}
	\label{t:req_by_sec}
\end{table}

По информации из таблицы~\ref{t:req_by_sec} был построен график на рисунке~\ref{img:graph_mean_by_sec}.

\includeimage
{graph_mean_by_sec} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{График зависимости скорости обработки запроса от числа поступаемых запросов в секунду} % Подпись рисунка


\section{Зависимость скорости обработки запроса от числа запросов в секунду}
В качестве кеша было использовано хранилище в оператирвной памяти redis~\cite{redis}. При запросе в случае отсутствия данных по данному id в кеше данные считывались в него, при удалении фрагмента из базы данных данный фрагмент также удалялся из из хранилища redis. В настройках redis максимальный объем хранимых данных был указан в 1 гигабайт, алгоритм вытеснения с наиболее давним обращением (англ. Least Recently Used сокр. lru). Условия замера аналогичны предыдущему исследованию.


В таблице~\ref{t:cache_cmp}, представлено сравнение двух реализаций, при этом в таблице было всего 5000 записей, в конце обработки запросов в кеше осталось 984 значения.

\begin{table}[h!tbp]
	\centering
	\caption{Зависимость времени обработки запроса от наличия кеша и числа обработанных запросов}
	  \begin{tabularx}{\linewidth}{|Z|Z|Z|}
	 	\hline
	 	Число обработанных запросов & Время обработки запроса без кеша (мс) & Время обработки запроса с кешем (мс) \\
	 	\hline
	 	0 & 2077 & 2043 \\ \hline
	 	3000 & 1002 & 44 \\ \hline
	 	6000 & 1094 & 15 \\ \hline
	 	9000 & 87 & 46 \\ \hline
	 	12000 & 1003 & 63 \\ \hline
	 	15000 & 94 & 82 \\ \hline
	 	18000 & 1101 & 66 \\ \hline
	 	21000 & 90 & 28 \\ \hline
	 	24000 & 92 & 46 \\ \hline 
	 	27000 & 1 & 48 \\ \hline
	 	30000 & 1200 & 171 \\ \hline
	 	33000 & 92 & 34 \\ \hline
	 	36000 & 1301 & 29 \\ \hline
	 	39000 & 1098 & 107 \\ \hline
	 	42000 & 1299 & 59 \\ \hline
	 	45000 & 199 & 150 \\ \hline
	 	48000 & 2904 & 42 \\ \hline
	 	51000 & 1398 & 72 \\ \hline
	 	54000 & 94 & 197 \\ \hline
	 	57000 & 1198 & 45 \\ \hline
	 	60000 & 2 & 46 \\ \hline
	 	63000 & 1499 & 19 \\ \hline
	 	66000 & 1201 & 42 \\ \hline
	 	69000 & 1197 & 93 \\ \hline
	 	72000 & 995 & 97 \\ \hline
	 	75000 & 1184 & 41 \\ \hline
	 	78000 & 1001 & 61 \\ \hline
	 	81000 & 93 & 53 \\ \hline
	 	84000 & 913 & 64 \\ \hline
	 	87000 & 901 & 60 \\ \hline
	 	90000 & 98 & 29 \\ \hline
	 	93000 & 98 & 50 \\ \hline
	 	96000 & 699 & 43 \\ \hline
	 	99000 & 203 & 27 \\ 
	 	\hline
	 	\end{tabularx}
	\label{t:cache_cmp}
\end{table}

В результате анализа таблицы~\ref{t:cache_cmp}, был получен график~\ref{img:graph_cache_annots_both}.

\includeimage
{graph_cache_annots_both} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{График зависимости скорости обработки запроса от наличия кеша и числа обработанных запросов} % Подпись рисунка







