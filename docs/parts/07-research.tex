\chapter{Исследовательская часть}

В данном разделе будет описана зависимость времени обработки запроса на получение разметки от числа запросов в секунду, а также сравнение времени обработки запроса с использованием кеширования и без использования кеширования. Также будет описаны технические характеристики устройства, на котором проводились замеры и приведен анализ полученных результатов.

\section{Технические характеристики}

Технические характеристики устройства, на котором выполнялись замеры времени, представлены далее.

\begin{enumerate}
	\item Процессор	Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz, 2592 МГц, ядер: 6, логических процессоров: 12.
	\item Оперативная память: 16 ГБайт.
	\item Операционная система: Майкрософт Windows 10 Pro \cite{windows}.
	\item Использованная подсистема: WSL2 \cite{WSL2}.
\end{enumerate}

При замерах времени ноутбук был включен в сеть электропитания.




\section{Зависимость скорости обработки запроса от числа запросов в секунду}
Для данного исследования в базу данных было сгенерировано и добавлено 20000 размеченных изображений от одного пользователя.

Для проведения исследования, была реализована программа на языке	 \texttt{Python}, в данной программе на каждый запрос создавался поток, после чего каждую секунду потоки замеряли время в секундах и сохраняли полученные данные его в список, см. листинг~\ref{lst:measure_time.py}.

Таким образом были отправлены запросы на получение сущности фрагмента, в данной реализации изображение хранится в виде байт в столбце базы данных.

Результаты измерений представлены в таблице~\ref{t:req_by_sec}.


\begin{table}[H]
	\centering
	\caption{Зависимость времени обработки запроса от числа запросов в секунду}
	\begin{tabularx}{\linewidth}{|Z|Z|}
		\hline
		 Число запросов в секунду & Время обработки (с)     \\
		\hline
	10 & 0.0132 \\ \hline
	20 & 0.0164 \\ \hline
	30 & 0.0179 \\ \hline
	40 & 0.0190 \\ \hline
	50 & 0.0216 \\ \hline
	60 & 0.0255 \\ \hline
	70 & 0.0409 \\ \hline
	80 & 0.0263 \\ \hline
	90 & 0.0290 \\ \hline
	100 & 0.0276 \\ \hline
	110 & 0.0302 \\ \hline
	120 & 0.0307 \\ \hline
	130 & 0.0343 \\ \hline
	140 & 0.0409 \\ \hline
	150 & 0.0436 \\ \hline
	160 & 0.0537 \\ \hline
	170 & 0.0571 \\ \hline
	180 & 0.0565 \\ \hline
	190 & 0.0569 \\ \hline
	200 & 0.0571 \\ \hline
	210 & 0.0693 \\ \hline
	220 & 0.0760 \\ \hline
	230 & 0.0730 \\ \hline
	240 & 0.0822 \\ \hline
	250 & 0.1251 \\ \hline
	260 & 0.1151 \\ \hline
	270 & 0.1028 \\ \hline
	280 & 0.1092 \\ \hline
	290 & 0.1103 \\ \hline
	300 & 0.1154 \\ \hline
	\end{tabularx}
	\label{t:req_by_sec}
\end{table}

По информации из таблицы~\ref{t:req_by_sec} был построен график на рисунке~\ref{img:graph_mean_by_sec}.

\includeimage
{graph_mean_by_sec} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{График зависимости скорости обработки запроса от числа поступаемых запросов в секунду} % Подпись рисунка


\section{Сравнение скорости реализаций с использованием кеша и без}

Для замера времени получения разметки со случайно сгенерированным id разметки использовалась программа JMeter~\cite{JMeter}, число клиентов запрашивающих данные было равно 100, на каждый клиент создавался отдельный поток, число запросов от одного клиента равно 1000, запросы от одного клиента поступали с задержкой 0.1 секунды, всего было обработано 99000 запросов.


В качестве кеша было использовано хранилище redis~\cite{redis}. При запросе в случае отсутствия данных по данному id в кеше данные считывались в него, при удалении фрагмента из базы данных данный фрагмент также удалялся из из хранилища redis. В настройках redis максимальный объем хранимых данных был указан в 1 гигабайт, алгоритм вытеснения с наиболее давним обращением (англ. Least Recently Used сокр. lru), в данном случае хранилище также использовало диск для сохранения текущего состояния данных.

При использовании кеша сначала происходило обращение к кешу, в случае если необходимого запроса там не оказывалось происходило обращение к базе данных и полученный ответ помещался в кеш.

В таблице~\ref{t:cache_cmp}	 представлено сравнение двух реализаций, при этом в таблице было всего 15000 записей, в конце обработки запросов в оперативной памяти кеша осталось 984 значения.

\begin{table}[H]
	\small
	\centering
	\caption{Зависимость времени обработки запроса от наличия кеша и числа обработанных запросов}
	  \begin{tabularx}{\linewidth}{|Z|Z|Z|}
	 	\hline
	 	Число обработанных запросов & Время обработки запроса без кеша (мс) & Время обработки запроса с кешем (мс) \\
	 	\hline
	 	0 & 2077 & 2043 \\ \hline
	 	3000 & 1002 & 44 \\ \hline
	 	6000 & 1094 & 15 \\ \hline
	 	9000 & 87 & 46 \\ \hline
	 	12000 & 1003 & 63 \\ \hline
	 	15000 & 94 & 82 \\ \hline
	 	18000 & 1101 & 66 \\ \hline
	 	21000 & 90 & 28 \\ \hline
	 	24000 & 92 & 46 \\ \hline 
	 	27000 & 1 & 48 \\ \hline
	 	30000 & 1200 & 171 \\ \hline
	 	33000 & 92 & 34 \\ \hline
	 	36000 & 1301 & 29 \\ \hline
	 	39000 & 1098 & 107 \\ \hline
	 	42000 & 1299 & 59 \\ \hline
	 	45000 & 199 & 150 \\ \hline
	 	48000 & 2904 & 42 \\ \hline
	 	51000 & 1398 & 72 \\ \hline
	 	54000 & 94 & 197 \\ \hline
	 	57000 & 1198 & 45 \\ \hline
	 	60000 & 2 & 46 \\ \hline
	 	63000 & 1499 & 19 \\ \hline
	 	66000 & 1201 & 42 \\ \hline
	 	69000 & 1197 & 93 \\ \hline
	 	72000 & 995 & 97 \\ \hline
	 	75000 & 1184 & 41 \\ \hline
	 	78000 & 1001 & 61 \\ \hline
	 	81000 & 93 & 53 \\ \hline
	 	84000 & 913 & 64 \\ \hline
	 	87000 & 901 & 60 \\ \hline
	 	90000 & 98 & 29 \\ \hline
	 	93000 & 98 & 50 \\ \hline
	 	96000 & 699 & 43 \\ \hline
	 	99000 & 203 & 27 \\ 
	 	\hline
	 	\end{tabularx}
	\label{t:cache_cmp}
\end{table}

В результате анализа таблицы~\ref{t:cache_cmp}, был получен график~\ref{img:graph_cache_annots_both}.

\includeimage
{graph_cache_annots_both} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{График зависимости скорости обработки запроса от наличия кеша и числа обработанных запросов} % Подпись рисунка

\section*{Вывод}
Среднее время обработки запроса увеличивается с ускорением при увелечении числа запросов в секунду(см.~рисунок~\ref{img:graph_mean_by_sec}). При увелечении числа запросов с 50 в 3 раза, среднее время обработки увеличилось в 2.01 раз, что связано с увеличением нагрузки на базу данных и конкуренции различных пользователей за ресурсы системы.

Использование кеша ускорило время обработки запросов(см.~рисунок~\ref{img:graph_cache_annots_both}). Изначально, до того как запрос попал в кеш время обработки запросов сопоставимо, однако при обнаружении данных запроса в кеше скорость обработки значительно возрастает.
При отсутствии объекта в кеше (0 обработанных запросов) время обработки данных с кешем меньше в 1.01 раз. При обнаружении требуемых данных в кеше, при 51000 обработанных запросов время обработки меньше в 19.41 раз. Это связано с большей скоростью получения информации из хранилища в оперативной памяти~(кеша).





