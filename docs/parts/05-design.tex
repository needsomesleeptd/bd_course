
\chapter{Конструкторская часть}
В данной части работы будет описана реализация базы данных, описана ER диаграмма БД и принципиальная схема БД, также будут описаны схемы триггеров и хранимые процедуры.


\section{Формализация взаимодействия с приложением}


Системе автоматической проверки необходимо проверить на правильность составные части отчета, что подразумевает детекцию рисунков, графиков, схем алгоритмов, списка используемых источников, а также формул.

На рисунках \ref{img:detection}--\ref{img:detection_inside} представлены результаты разработки системы детекции составных частей.

\includeimage
{detection} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{IDEF0 обнаружение составных частей отчет 0 уровня} % Подпись рисунка

\includeimage
{detection_inside} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{IDEF0 обнаружение составных частей отчета 1 уровня} % Подпись рисунка

После решения задачи детекции необходимо проверить составные части на соответствие ГОСТ 7.32, однако, финальный вердикт должен выноситься экспертом. На рисунках \ref{img:errors}--\ref{img:errors_inside} представлены результаты разработки данной системы.

\includeimage
{errors} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{IDEF0 проверки составных частей отчета на соответствие ГОСТ 7.32 0 уровня} % Подпись рисунка

\includeimage
{errors_inside} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{IDEF0 проверки составных частей отчета на соответствие ГОСТ 7.32 1 уровня} % Подпись рисунка


\section{Формализация сущностей базы данных}

В соответствие с диаграммами~\ref{img:errors}--\ref{img:errors_inside} были выделены следующие таблицы:
\begin{enumerate}
	\item студент --- сущность студента (имеет уникальный идентификатор для связи со сданными отчетами и комментариями);
	\item нормоконтроллеер --- сущность нормоконтроллера (имеет уникальный идентификатор для связи с проверенными отчетами и созданными ошибками);
	\item выделенный фрагмент --- сущность ошибок в отчетах студентов (хранит страницу отчета с ошибкой, а также данные, указывающие на местоположение ошибки, а также тип фрагмента);
	\item тип фрагмента~---~сущность типов ошибок (необходима для введения новых типов ошибок, хранит описание ошибки);
	\item отчет --- сущность отчета студента (хранит все страницы попытки сдачи отчета, а также время сдачи и номер попытки сдачи);
	\item комментарий --- сущность комментария студента о ошибке (в случае ошибки преподавателя можно указать на это, кроме данных комментария хранит идентификатор студента, создавшего комментарий);
	\item достижение --- сущность награды для выдачи студентам, преуспевающим в выполнении лабораторных работ (хранит идентификатор студента, которому выдали награду, а также идентификатор отчета, за который было получено достижение).
\end{enumerate}

Для описания сценариев взаимодействия пользователей с системой была создана диаграмма прецедентов, представленная на рисунке~\ref{img:BD_use_cases}.

\includeimage
{BD_use_cases} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{Диаграмма прецедентов} % Подпись рисунка

На основе описанной информации была получена диаграмма сущность---связь, представленная на рисунке~\ref{img:ER_RU}.
\includeimage
{ER_RU} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{Диаграмма сущность---связь} % Подпись рисунка

\section{Ролевая модель}
Была определена следующая ролевая модель:
\begin{enumerate}
	\item Разметчик --- имеет права доступа SELECT к таблице документов и INSERT к таблице выделенных фрагментов.
	\item Добавляющий --- имеет права доступа INSERT к таблице студентов и нормоконтроллеров
	\item Пользователь --- имеет права доступа INSERT к таблице комментариев, имеет права доступа SELECT  и INSERT к таблице выделенных фрагментов.
	\item Нормоконтроллер --- является разметчиков, также имеет права доступа INSERT к таблице тип\_ошибки и таблице достижений.
	\item Администратор имеет все права доступа ко всем таблицам.
	\item Система является разметчиком и добавляюшим.
\end{enumerate}
\section{Используемые триггеры}
В базе данных присутствует триггер, запускающий процесс обнаружения ошибок в отчете при добавлении отчета в базу данных. При вставке экземпляра отчета в базу данных будет запущена система тестирования, которая детектирует ошибки в частях отчета и заполняет таблицу с ошибками в отчете. 
\includeimage
{add_trigger} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{1\textwidth} % Ширина рисунка
{Схема алгоритма триггера после добавления в таблицу отчетов} % Подпись рисунка

\section*{Вывод}
В данной части были формализованы процессы автоматической проверки, а также выделены различные виды пользователей: нормоконоктроллер, студент, система и администратор, после чего были определены права для каждого из пользователей.




